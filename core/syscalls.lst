   1              		.syntax unified
   2              		.cpu cortex-m4
   3              		.eabi_attribute 27, 3
   4              		.eabi_attribute 28, 1
   5              		.fpu fpv4-sp-d16
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 2
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.thumb
  16              		.file	"syscalls.c"
  17              		.text
  18              	.Ltext0:
  19              		.cfi_sections	.debug_frame
  20              		.section	.text._sbrk,"ax",%progbits
  21              		.align	2
  22              		.p2align 4,,15
  23              		.global	_sbrk
  24              		.thumb
  25              		.thumb_func
  27              	_sbrk:
  28              	.LFB112:
  29              		.file 1 "core/syscalls.c"
   1:core/syscalls.c **** // from newlib_stubs.c
   2:core/syscalls.c **** 
   3:core/syscalls.c **** #include "stm32f4xx.h"
   4:core/syscalls.c **** #include <sys/types.h>
   5:core/syscalls.c **** #include <errno.h>
   6:core/syscalls.c **** 
   7:core/syscalls.c **** caddr_t _sbrk(int incr) {
  30              		.loc 1 7 0
  31              		.cfi_startproc
  32              		@ args = 0, pretend = 0, frame = 0
  33              		@ frame_needed = 0, uses_anonymous_args = 0
  34              	.LVL0:
   8:core/syscalls.c **** 
   9:core/syscalls.c **** 	extern char _ebss; // Defined by the linker
  10:core/syscalls.c **** 	static char *heap_end;
  11:core/syscalls.c **** 	char *prev_heap_end;
  12:core/syscalls.c **** 
  13:core/syscalls.c **** 	if (heap_end == 0) {
  35              		.loc 1 13 0
  36 0000 0C49     		ldr	r1, .L8
   7:core/syscalls.c **** caddr_t _sbrk(int incr) {
  37              		.loc 1 7 0
  38 0002 08B5     		push	{r3, lr}
  39              	.LCFI0:
  40              		.cfi_def_cfa_offset 8
  41              		.cfi_offset 3, -8
  42              		.cfi_offset 14, -4
  43              		.loc 1 13 0
  44 0004 0B68     		ldr	r3, [r1, #0]
  45 0006 8BB1     		cbz	r3, .L6
  46              	.L2:
  47              	.LVL1:
  14:core/syscalls.c **** 		heap_end = &_ebss;
  15:core/syscalls.c **** 	}
  16:core/syscalls.c **** 	prev_heap_end = heap_end;
  17:core/syscalls.c **** 
  18:core/syscalls.c **** 	//todo: check consumtion
  19:core/syscalls.c **** 	//char * stack = (char*) __get_MSP();
  20:core/syscalls.c **** 	if (heap_end + incr >  (char*)0x2002FC00)
  48              		.loc 1 20 0
  49 0008 4FF47C42 		mov	r2, #64512
  50 000c 1818     		adds	r0, r3, r0
  51              	.LVL2:
  52 000e C2F20202 		movt	r2, 8194
  53 0012 9042     		cmp	r0, r2
  54 0014 02D8     		bhi	.L7
  21:core/syscalls.c **** 	{
  22:core/syscalls.c **** 		//_write (STDERR_FILENO, "Heap and stack collision\n", 25);
  23:core/syscalls.c **** 		errno = ENOMEM;
  24:core/syscalls.c **** 		return  (caddr_t) -1;
  25:core/syscalls.c **** 		//abort ();
  26:core/syscalls.c **** 	}
  27:core/syscalls.c **** 
  28:core/syscalls.c **** 	heap_end += incr;
  55              		.loc 1 28 0
  56 0016 0860     		str	r0, [r1, #0]
  29:core/syscalls.c **** 	return (caddr_t) prev_heap_end;
  30:core/syscalls.c **** 
  31:core/syscalls.c **** }
  57              		.loc 1 31 0
  58 0018 1846     		mov	r0, r3
  59 001a 08BD     		pop	{r3, pc}
  60              	.L7:
  23:core/syscalls.c **** 		errno = ENOMEM;
  61              		.loc 1 23 0
  62 001c FFF7FEFF 		bl	__errno
  63              	.LVL3:
  64 0020 0C21     		movs	r1, #12
  24:core/syscalls.c **** 		return  (caddr_t) -1;
  65              		.loc 1 24 0
  66 0022 4FF0FF33 		mov	r3, #-1
  23:core/syscalls.c **** 		errno = ENOMEM;
  67              		.loc 1 23 0
  68 0026 0160     		str	r1, [r0, #0]
  69              		.loc 1 31 0
  70 0028 1846     		mov	r0, r3
  71 002a 08BD     		pop	{r3, pc}
  72              	.LVL4:
  73              	.L6:
  14:core/syscalls.c **** 		heap_end = &_ebss;
  74              		.loc 1 14 0
  75 002c 024B     		ldr	r3, .L8+4
  76 002e 0B60     		str	r3, [r1, #0]
  77 0030 EAE7     		b	.L2
  78              	.L9:
  79 0032 00BF     		.align	2
  80              	.L8:
  81 0034 00000000 		.word	.LANCHOR0
  82 0038 00000000 		.word	_ebss
  83              		.cfi_endproc
  84              	.LFE112:
  86 003c AFF30080 		.section	.text._exit,"ax",%progbits
  87              		.align	2
  88              		.p2align 4,,15
  89              		.global	_exit
  90              		.thumb
  91              		.thumb_func
  93              	_exit:
  94              	.LFB113:
  32:core/syscalls.c **** 
  33:core/syscalls.c **** void _exit(void) {
  95              		.loc 1 33 0
  96              		.cfi_startproc
  97              		@ Volatile: function does not return.
  98              		@ args = 0, pretend = 0, frame = 0
  99              		@ frame_needed = 0, uses_anonymous_args = 0
 100              		@ link register save eliminated.
 101              	.L11:
 102 0000 FEE7     		b	.L11
 103              		.cfi_endproc
 104              	.LFE113:
 106 0002 00BFAFF3 		.section	.bss.heap_end.7791,"aw",%nobits
 106      0080AFF3 
 106      0080AFF3 
 106      0080
 107              		.align	2
 108              		.set	.LANCHOR0,. + 0
 111              	heap_end.7791:
 112 0000 00000000 		.space	4
 113              		.text
 114              	.Letext0:
 115              		.file 2 "/home/pedro/gcc-arm-none-eabi-4_7-2013q3/bin/../lib/gcc/arm-none-eabi/4.7.4/include/stdin
 116              		.file 3 "/home/pedro/gcc-arm-none-eabi-4_7-2013q3/bin/../lib/gcc/arm-none-eabi/4.7.4/../../../../a
 117              		.file 4 "core/core_cm4.h"
 118              		.file 5 "/home/pedro/gcc-arm-none-eabi-4_7-2013q3/bin/../lib/gcc/arm-none-eabi/4.7.4/../../../../a
DEFINED SYMBOLS
                            *ABS*:00000000 syscalls.c
     /tmp/ccx7r6EL.s:21     .text._sbrk:00000000 $t
     /tmp/ccx7r6EL.s:27     .text._sbrk:00000000 _sbrk
     /tmp/ccx7r6EL.s:81     .text._sbrk:00000034 $d
     /tmp/ccx7r6EL.s:87     .text._exit:00000000 $t
     /tmp/ccx7r6EL.s:93     .text._exit:00000000 _exit
     /tmp/ccx7r6EL.s:107    .bss.heap_end.7791:00000000 $d
     /tmp/ccx7r6EL.s:111    .bss.heap_end.7791:00000000 heap_end.7791
                     .debug_frame:00000010 $d
     /tmp/ccx7r6EL.s:86     .text._sbrk:0000003c $t

UNDEFINED SYMBOLS
__errno
_ebss
